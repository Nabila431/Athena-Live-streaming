<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Beranda - Live And Streaming by Nabila Ahmad Studio Development
    </title>
    <link rel="stylesheet" href="css/style.css" />
    <script src="https://unpkg.com/@mux/mux-player"></script>
  </head>
  <body>
    <header class="main-header">
      <div class="container navbar">
        <a href="index.html" class="logo">
          <img src="assets/logo.svg" alt="Nabila Stream Logo" />
          <span>Nabila Stream</span>
        </a>
        <nav>
          <ul class="nav-links">
            <li><a href="index.html" class="active">Beranda</a></li>
            <li><a href="studio.html">Studio</a></li>
            <li><a href="posts.html">Posts</a></li>
            <li><a href="chat.html">Chat</a></li>
            <li><a href="profile.html">Profil</a></li>
          </ul>
        </nav>
        <div class="auth-buttons">
          <a href="Auth.html" id="loginRegisterBtn" class="btn"
            >Login / Daftar</a
          >
          <div class="user-info" style="display: none" id="userInfo">
            <img
              id="userAvatar"
              class="nav-user-avatar"
              style="display: none"
            />
            <span id="userName" style="display: none"></span>
            <button id="logoutBtn" class="btn" style="display: none">
              Logout
            </button>
          </div>
        </div>
      </div>
    </header>

    <main>
      <section class="hero-section">
        <div class="container">
          <h1>🎥 Temukan Live Streaming Terbaik</h1>
          <p>
            Tonton streamer favoritmu, ikuti konten menarik, dan mulai live-mu
            sendiri sekarang!
          </p>
          <div class="hero-actions">
            <a href="studio.html" class="btn">🎬 Mulai Live Sekarang!</a>
            <a
              href="posts.html"
              class="btn"
              style="background: var(--primary-color)"
              >📝 Buat Post</a
            >
            <a href="chat.html" class="btn" style="background: #27ae60"
              >💬 Join Chat</a
            >
          </div>
        </div>
      </section>

      <section class="container">
        <h2>🔴 Live Streaming yang Sedang Berlangsung</h2>
        <div class="stream-grid" id="liveStreamsContainer">
          <!-- Live streams akan dimuat di sini -->
        </div>
        <p
          id="noStreamsMessage"
          style="text-align: center; color: var(--text-dark); display: none"
        >
          Belum ada live stream yang aktif saat ini.
          <a href="studio.html">Mulai live pertama!</a>
        </p>
      </section>

      <section class="container" style="margin-top: 50px">
        <h2>📝 Post Terbaru dari Komunitas</h2>
        <div id="recentPostsContainer" class="posts-preview">
          <!-- Recent posts akan dimuat di sini -->
        </div>
        <div style="text-align: center; margin-top: 20px">
          <a href="posts.html" class="btn">📖 Lihat Semua Posts</a>
        </div>
      </section>

      <section class="container" style="margin-top: 50px">
        <h2>📊 Statistik Platform</h2>
        <div class="platform-stats">
          <div class="stat-card">
            <div class="stat-number" id="totalUsers">0</div>
            <div class="stat-label">👥 Total Users</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="liveStreams">0</div>
            <div class="stat-label">🔴 Live Streams</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="totalPosts">0</div>
            <div class="stat-label">📝 Total Posts</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="onlineNow">0</div>
            <div class="stat-label">🟢 Online Now</div>
          </div>
        </div>
      </section>
    </main>

    <footer class="main-footer">
      <div class="container">
        <p>
          &copy; 2025 Live And Streaming by Nabila Ahmad Studio Development. All
          rights reserved.
        </p>
        <p style="margin-top: 10px; font-size: 0.9rem; color: var(--text-dark)">
          🎮 Platform streaming terlengkap untuk kreator Indonesia •
          <a href="posts.html">Posts</a> • <a href="chat.html">Chat</a> •
          <a href="studio.html">Studio</a>
        </p>
      </div>
    </footer>

    <script src="js/auth-enhanced.js"></script>
    <script>
      // Enhanced home page functionality
      document.addEventListener("DOMContentLoaded", () => {
        // Setup logout button
        const logoutBtn = document.getElementById("logoutBtn");
        if (logoutBtn) {
          logoutBtn.addEventListener("click", handleLogout);
        }

        // Load content
        loadLiveStreams();
        loadRecentPosts();
        loadPlatformStats();

        // Refresh live streams every 30 seconds
        setInterval(loadLiveStreams, 30000);
      });

      function loadLiveStreams() {
        const container = document.getElementById("liveStreamsContainer");
        const noStreamsMessage = document.getElementById("noStreamsMessage");

        // Get live streams from localStorage
        const streams = JSON.parse(
          localStorage.getItem("nabila_streams") || "[]",
        );
        const liveStreams = streams.filter(
          (stream) => stream.status === "live",
        );

        if (liveStreams.length === 0) {
          // Show sample streams for demonstration
          const sampleStreams = [
            {
              id: "sample1",
              title: "🎮 Gaming Session - Mobile Legends",
              streamer: {
                name: "GamerPro",
                avatar:
                  "https://ui-avatars.com/api/?name=GamerPro&background=6a11cb&color=fff",
              },
              viewers: 142,
              thumbnail:
                "https://via.placeholder.com/350x200?text=Gaming+Stream",
            },
            {
              id: "sample2",
              title: "🎵 Music Live - Acoustic Session",
              streamer: {
                name: "MusicLover",
                avatar:
                  "https://ui-avatars.com/api/?name=MusicLover&background=2575fc&color=fff",
              },
              viewers: 89,
              thumbnail:
                "https://via.placeholder.com/350x200?text=Music+Stream",
            },
          ];

          container.innerHTML = sampleStreams
            .map(
              (stream) => `
                    <div class="stream-card">
                        <a href="stream.html?id=${stream.id}">
                            <div class="stream-card-thumbnail">
                                <img src="${stream.thumbnail}" alt="Stream Thumbnail">
                                <span class="live-badge">LIVE</span>
                                <span class="viewer-count">${stream.viewers} viewers</span>
                            </div>
                            <div class="stream-card-info">
                                <h3>${stream.title}</h3>
                                <div class="streamer-info">
                                    <img src="${stream.streamer.avatar}" alt="${stream.streamer.name}">
                                    <span>${stream.streamer.name}</span>
                                </div>
                            </div>
                        </a>
                    </div>
                `,
            )
            .join("");

          noStreamsMessage.style.display = "none";
        } else {
          container.innerHTML = liveStreams
            .map(
              (stream) => `
                    <div class="stream-card">
                        <a href="stream.html?id=${stream.id}">
                            <div class="stream-card-thumbnail">
                                <img src="${stream.thumbnail}" alt="Stream Thumbnail">
                                <span class="live-badge">LIVE</span>
                                <span class="viewer-count">${stream.viewers} viewers</span>
                            </div>
                            <div class="stream-card-info">
                                <h3>${stream.title}</h3>
                                <div class="streamer-info">
                                    <img src="${stream.streamer.avatar}" alt="${stream.streamer.name}">
                                    <span>${stream.streamer.name}</span>
                                </div>
                            </div>
                        </a>
                    </div>
                `,
            )
            .join("");

          noStreamsMessage.style.display = "none";
        }
      }

      function loadRecentPosts() {
        const container = document.getElementById("recentPostsContainer");
        const posts = JSON.parse(localStorage.getItem("nabila_posts") || "[]");

        if (posts.length === 0) {
          container.innerHTML = `
                    <div class="no-posts-preview">
                        <p>📝 Belum ada post dari komunitas. <a href="posts.html">Buat post pertama!</a></p>
                    </div>
                `;
          return;
        }

        const recentPosts = posts.slice(0, 3);
        container.innerHTML = recentPosts
          .map(
            (post) => `
                <div class="post-preview-card">
                    <div class="post-preview-header">
                        <img src="${post.author.avatar}" alt="${post.author.name}" class="author-avatar-small">
                        <div>
                            <strong>${post.author.name}</strong>
                            <small>${new Date(post.created_at).toLocaleDateString("id-ID")}</small>
                        </div>
                    </div>
                    <h4>${post.title}</h4>
                    <p>${post.content.substring(0, 100)}${post.content.length > 100 ? "..." : ""}</p>
                    <div class="post-preview-stats">
                        <span>❤️ ${post.likes}</span>
                        <span>💬 ${post.comments.length}</span>
                    </div>
                </div>
            `,
          )
          .join("");
      }

      function loadPlatformStats() {
        const users = JSON.parse(localStorage.getItem("nabila_users") || "[]");
        const streams = JSON.parse(
          localStorage.getItem("nabila_streams") || "[]",
        );
        const posts = JSON.parse(localStorage.getItem("nabila_posts") || "[]");
        const onlineUsers = JSON.parse(
          localStorage.getItem("nabila_online") || "[]",
        );

        const liveStreams = streams.filter((s) => s.status === "live");
        const recentOnline = onlineUsers.filter(
          (u) => Date.now() - u.lastSeen < 5 * 60 * 1000,
        );

        document.getElementById("totalUsers").textContent = users.length;
        document.getElementById("liveStreams").textContent = liveStreams.length;
        document.getElementById("totalPosts").textContent = posts.length;
        document.getElementById("onlineNow").textContent = recentOnline.length;
      }
    </script>

    <style>
      .hero-actions {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-top: 30px;
        flex-wrap: wrap;
      }

      .viewer-count {
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 3px 8px;
        border-radius: 12px;
        font-size: 0.8rem;
      }

      .posts-preview {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .post-preview-card {
        background: var(--card-bg);
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
      }

      .post-preview-header {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
      }

      .author-avatar-small {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        margin-right: 10px;
      }

      .post-preview-card h4 {
        color: var(--text-light);
        margin-bottom: 10px;
      }

      .post-preview-card p {
        color: var(--text-dark);
        line-height: 1.5;
        margin-bottom: 15px;
      }

      .post-preview-stats {
        display: flex;
        gap: 15px;
        font-size: 0.9rem;
        color: var(--text-dark);
      }

      .platform-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .stat-card {
        background: var(--card-bg);
        padding: 30px 20px;
        border-radius: 12px;
        text-align: center;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
      }

      .stat-number {
        font-size: 2.5rem;
        font-weight: bold;
        color: var(--secondary-color);
        margin-bottom: 10px;
      }

      .stat-label {
        color: var(--text-dark);
        font-size: 1rem;
      }

      .no-posts-preview {
        text-align: center;
        padding: 40px;
        color: var(--text-dark);
      }

      @media (max-width: 768px) {
        .hero-actions {
          flex-direction: column;
          align-items: center;
        }

        .platform-stats {
          grid-template-columns: repeat(2, 1fr);
        }
      }
    </style>
  </body>
</html>
