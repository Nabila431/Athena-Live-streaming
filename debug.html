<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Debug - Supabase Connection Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .test-card {
        background: white;
        padding: 20px;
        margin: 10px 0;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .success {
        border-left: 4px solid #4caf50;
      }
      .error {
        border-left: 4px solid #f44336;
      }
      .info {
        border-left: 4px solid #2196f3;
      }
      button {
        background: #2196f3;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #1976d2;
      }
      pre {
        background: #f4f4f4;
        padding: 10px;
        border-radius: 4px;
        overflow-x: auto;
      }
    </style>
  </head>
  <body>
    <h1>🔧 Supabase Connection Debug</h1>

    <div class="test-card info">
      <h3>Supabase Configuration</h3>
      <p><strong>URL:</strong> <span id="supabaseUrl">Loading...</span></p>
      <p><strong>Key:</strong> <span id="supabaseKey">Loading...</span></p>
    </div>

    <div class="test-card">
      <h3>Connection Tests</h3>
      <button onclick="testSupabaseLoaded()">Test Supabase Loaded</button>
      <button onclick="testConnection()">Test Connection</button>
      <button onclick="testAuthGetUser()">Test Auth Get User</button>
      <button onclick="testSignUp()">Test Registration</button>
      <button onclick="testSignIn()">Test Login</button>
      <button onclick="clearResults()">Clear Results</button>
    </div>

    <div id="results"></div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/main.js"></script>
    <script>
      function addResult(title, content, type = "info") {
        const results = document.getElementById("results");
        const div = document.createElement("div");
        div.className = `test-card ${type}`;
        div.innerHTML = `
                <h4>${title}</h4>
                <pre>${typeof content === "object" ? JSON.stringify(content, null, 2) : content}</pre>
                <small>Time: ${new Date().toLocaleTimeString()}</small>
            `;
        results.appendChild(div);
      }

      function clearResults() {
        document.getElementById("results").innerHTML = "";
      }

      async function testSupabaseLoaded() {
        try {
          if (typeof Supabase === "undefined") {
            addResult(
              "❌ Supabase Library",
              "Supabase library not loaded",
              "error",
            );
            return;
          }

          if (typeof supabase === "undefined") {
            addResult(
              "❌ Supabase Client",
              "Supabase client not initialized",
              "error",
            );
            return;
          }

          addResult(
            "✅ Supabase Library",
            "Supabase library and client loaded successfully",
            "success",
          );

          // Show config
          document.getElementById("supabaseUrl").textContent =
            "https://vgchzuqtrmohyzojvngw.supabase.co";
          document.getElementById("supabaseKey").textContent =
            "eyJhbGci...JObapii_2g (anon key)";
        } catch (error) {
          addResult("❌ Supabase Test", error.message, "error");
        }
      }

      async function testConnection() {
        try {
          addResult(
            "🔄 Testing Connection",
            "Attempting connection...",
            "info",
          );

          const { data, error } = await supabase.auth.getSession();

          if (error) {
            addResult("❌ Connection Failed", error, "error");
          } else {
            addResult(
              "✅ Connection Success",
              "Successfully connected to Supabase",
              "success",
            );
          }
        } catch (error) {
          addResult("❌ Connection Error", error.message, "error");
        }
      }

      async function testAuthGetUser() {
        try {
          addResult("🔄 Testing Auth", "Getting current user...", "info");

          const { data, error } = await supabase.auth.getUser();

          if (error) {
            addResult("❌ Auth Error", error, "error");
          } else {
            addResult("✅ Auth Success", { user: data.user }, "success");
          }
        } catch (error) {
          addResult("❌ Auth Exception", error.message, "error");
        }
      }

      async function testSignUp() {
        const testEmail = "test-" + Date.now() + "@example.com";
        const testPassword = "testpassword123";

        try {
          addResult(
            "🔄 Testing Registration",
            `Attempting registration with ${testEmail}`,
            "info",
          );

          const { data, error } = await supabase.auth.signUp({
            email: testEmail,
            password: testPassword,
          });

          if (error) {
            addResult("❌ Registration Failed", error, "error");
          } else {
            addResult(
              "✅ Registration Success",
              {
                user: data.user
                  ? { id: data.user.id, email: data.user.email }
                  : null,
                session: data.session ? "Session created" : "No session",
              },
              "success",
            );
          }
        } catch (error) {
          addResult("❌ Registration Exception", error.message, "error");
        }
      }

      async function testSignIn() {
        const testEmail = prompt("Enter email to test login:");
        const testPassword = prompt("Enter password:");

        if (!testEmail || !testPassword) {
          addResult(
            "⚠️ Login Test Cancelled",
            "No email or password provided",
            "info",
          );
          return;
        }

        try {
          addResult(
            "🔄 Testing Login",
            `Attempting login with ${testEmail}`,
            "info",
          );

          const { data, error } = await supabase.auth.signInWithPassword({
            email: testEmail,
            password: testPassword,
          });

          if (error) {
            addResult("❌ Login Failed", error, "error");
          } else {
            addResult(
              "✅ Login Success",
              {
                user: data.user
                  ? { id: data.user.id, email: data.user.email }
                  : null,
                session: data.session ? "Session created" : "No session",
              },
              "success",
            );
          }
        } catch (error) {
          addResult("❌ Login Exception", error.message, "error");
        }
      }

      // Auto-run basic tests
      window.addEventListener("load", () => {
        setTimeout(() => {
          testSupabaseLoaded();
          setTimeout(testConnection, 500);
        }, 1000);
      });
    </script>
  </body>
</html>
